# AplicationStatusTracking

## Прецедент: "Просмотр статуса заявки"

Информационная система технической экспертизы.

---

## Уровень
Задача, определенная системой.

---

## Основные исполнители
**Заявитель (Applicant) и Держатель фонда (FundHolder)**

---

## Заинтересованные лица и их требования

### 1. Заявитель (Applicant)
- Возможность просматривать актуальный статус своей заявки в любое время.
- Получение уведомлений о изменениях статуса заявки (например, при переходе на новый этап).
- Доступ к истории изменений статуса и комментариям, связанным с заявкой.

### 2. Держатель фонда (FundHolder)
- Возможность просматривать статус заявок, находящихся на рассмотрении или уже одобренных.
- Уведомление о любых изменениях в статусе заявок, которые могут требовать их внимания.
- Доступ к отчетам о состоянии всех заявок для принятия обоснованных решений.

### 3. Администратор системы
- Контроль за доступом пользователей к информации о статусе заявок.
- Логирование всех запросов на просмотр статуса для аудита и анализа использования системы.
- Обеспечение корректности отображаемой информации о статусах заявок.

### 4. Операционный менеджер (OperationalManager) (опционально)
- Анализ статистики обработки заявок и текущих статусов для оптимизации процессов.
- Доступ к отчетам по времени обработки заявок на разных этапах.

## Предусловия

1. Заявка подана и зарегистрирована в системе.
2. Пользователь (заявитель, держатель фонда или другой заинтересованный участник) авторизован в системе.
3. Пользователь имеет необходимые права доступа для просмотра статуса заявки.
4. Статус заявки сохранен и доступен в системе.

## Результаты (Постусловия)

1. Пользователь получил актуальный статус заявки.
2. История изменений статуса заявки отображается пользователю.
3. Запрос на просмотр статуса заявки зарегистрирован в системе для аудита.
4. При необходимости пользователь уведомлен о последнем изменении статуса заявки через `NotificationManager`.
5. Система зафиксировала время и дату последнего запроса на просмотр статуса для аналитики.

---

## Основной успешный сценарий

### 1. Авторизация пользователя
- Пользователь (заявитель или держатель фонда) вводит свои учетные данные и инициирует процесс авторизации через `IAuthManager::authenticate(user)`.

### 2. Успешная авторизация
- Система проверяет учетные данные и предоставляет пользователю доступ к интерфейсу с возможностью управления заявками.

### 3. Запрос на просмотр статуса заявки
- Пользователь выбирает опцию для просмотра статуса заявки и инициирует запрос через `IApplicationManager::getApplicationByID(applicationID)`.

### 4. Получение данных заявки
- Система обрабатывает запрос и возвращает объект Application, содержащий следующую необходимую информацию:
  - ID: уникальный идентификатор заявки.
  - Title: название заявки.
  - Description: описание заявки.
  - Status: текущий статус заявки.
  - Applicant: информация о заявителе.

### 5. Получение истории изменений статуса
- По запросу пользователя, система извлекает историю изменений статуса заявки через `IApplicationManager::getApplicationHistory(applicationID)`.
- Система возвращает список изменений статуса с деталями:
  - Status: каждый статус заявки на момент изменения.
  - ChangeDate: дата и время изменения статуса.
  - Comments: комментарии, связанные с изменением статуса.

### 6. Отображение информации пользователю
- Система формирует интерфейс вывода информации, отображая:
  - Текущий статус заявки.
  - Историю изменений статуса с соответствующими датами и комментариями.
- Пользователь может просматривать эти данные, что помогает ему понять текущее состояние заявки.

### 7. Логирование действия
- Система фиксирует действие пользователя по запросу статуса заявки через `IAuthManager::logAction(userID, action, applicationID)`.
- Запись включает время и дату запроса для обеспечения аналитики и аудита.

### 8. Уведомление (при необходимости)
- Если статус заявки был изменен с момента последнего запроса, система может отправить уведомление пользователю через `INotificationManager::sendNotification(notification)`, содержащее сообщение о последнем изменении статуса (например, "Статус вашей заявки изменён. Текущий статус: 'На рассмотрении'.").

---

## Варианты альтернативных решений

### 1. Ошибка авторизации пользователя
- Если `IAuthManager::authenticate(user)` возвращает ошибку:
  - Система уведомляет пользователя о неправильных учетных данных или проблеме авторизации.
  - Пользователь может повторно ввести свои учетные данные или восстановить пароль.

### 2. Заявка не найдена
- Если `IApplicationManager::getApplicationByID(applicationID)` возвращает ошибку (например, указан несуществующий идентификатор):
  - Система отображает сообщение об ошибке: "Заявка с указанным ID не найдена."
  - Пользователь получает предложения по повторному вводу идентификатора или переходу к списку доступных заявок.

### 3. Ошибка получения истории статуса
- Если `IApplicationManager::getApplicationHistory(applicationID)` возвращает ошибку:
  - Система уведомляет пользователя о том, что произошла ошибка при попытке извлечь историю изменений статус заявки.
  - Пользователь может попробовать обновить страницу или запросить статус позже.

### 4. Ошибка логирования действия
- Если `IAuthManager::logAction(userID, action, applicationID)` возвращает ошибку:
  - Система фиксирует ошибку через `ReportManager::logIssue`.
  - Администратор уведомляется о проблеме с аудитом действий пользователя.

### 5. Ошибка отправки уведомления (если требуется)
- Если во время процесса просмотра статуса заявки пользователю необходимо отправить уведомление об изменении статуса, и `INotificationManager::sendNotification(notification)` возвращает ошибку:
  - Система повторяет попытку отправки уведомления.
  - Если уведомление не доставлено, фиксируется ошибка через `ReportManager`.

### 6. Отмена просмотра статуса
- Если пользователь решает отменить запрос на просмотр статуса до того, как система завершит загрузку данных:
  - Система прекращает загрузку, и пользователь возвращается к предыдущему экрану.
  - Никакие данные не отображаются, и история изменений статуса не извлекается.

---

## Расширения

### 1. Просмотр статуса нескольких заявок
- Пользователь имеет возможность запросить статус нескольких заявок одновременно.
- Система обрабатывает запросы через `StatusManager` и возвращает статусы всех заявок в одном ответе.

### 2. Уведомление о изменении статуса
- Пользователь может подписаться на уведомления о изменении статуса своей заявки.
- При изменении статуса заявки система автоматически отправляет уведомление через `NotificationManager`.

### 3. Фильтрация по статусу
- Пользователь может фильтровать заявки по статусу (например, "Ожидает", "Одобрена", "Отклонена").
- Система использует `StatusManager` для отбора заявок и отображает их пользователю через `UserInterface`.

### 4. Исторический просмотр статусов
- Пользователь имеет возможность просмотреть историю изменений статуса заявки.
- Система предоставляет доступ к архивным данным через `StatusManager`, отображая изменения в хронологическом порядке.

### 5. Автоматизированые отчеты о статусах
- Система генерирует автоматические отчеты по состоянию всех заявок за определенный период.
- `ReportsManager` отвечает за сбор данных и формирование отчетов, которые отправляются по запросу через `UserInterface`.

---

## Специальные требования

1. Все запросы на просмотр статуса заявки должны быть зафиксированы через `ReportManager` для обеспечения аудита и прозрачности.
2. Информация о статусе заявки должна быть обновлена в системе не позднее 15 минут с момента изменения статуса.
3. Уведомления о статусе заявки должны быть доступны заявителю сразу после обновления статуса, без задержек.

---

## Связь с диаграммой классов для прецедента "Просмотр статуса заявок"

1. `ApplicationManager`
   - Управляет данными заявок, предоставляет доступ к информации о статусе через метод `getApplicationStatus(applicationID)`.

2. `ExpertiseManager`
   - Обеспечивает доступ к экспертным оценкам, если это необходимо для отображения статуса заявки, через `getEvaluation(applicationID)` (например, для информации о текущей оценке).

3. `DecisionManager`
   - Позволяет получить информацию о принятых решениях по заявкам через `getDecision(applicationID)` (например, для отображения текущего статуса на основе решения).

4. `NotificationManager`
   - Уведомляет заявителей о любых изменениях в статусе их заявок через метод `sendStatusNotification(applicationID) (например, когда статус заявки обновляется).

5. `ReportManager`
   - Логирует действия системы и формирует отчеты о статусах заявок через `generateStatusReport()` (например, для статистического анализа состояния заявок).

6. `AuthManager`
   - Управляет сессиями пользователей и проверяет их права доступа к информации о статусах заявок через `getUserPermissions(userID)` (например, чтобы убедиться, что только авторизованные пользователи могут видеть свои статусы заявок).