# RejectionManagement.md

## Прецедент: "Управление отказами"
Информационная система технической экспертизы.

---

## Уровень  
Задача, определенная системой.

---

## Основной исполнитель  
**Держатель фонда (FundHolder)**

---

## Заинтересованные лица и их требования

### 1. Держатель фонда (FundHolder)
- Возможность эффективно управлять отказами по заявкам через `DecisionManager`.
- Уведомление заявителя о причинах отказа через `NotificationManager`.
- История всех решений фиксируется через `ReportManager`.

### 2. Заявитель (Applicant)
- Получение уведомления об отказе через `NotificationManager`.
- Прозрачность и обоснование причин отказа (указанных в объекте `Decision`).

### 3. Администратор системы
- Контроль корректности процессов управления отказами.
- Логирование всех действий через `ReportManager`.

---

## Предусловия
1. Эксперты завершили процесс оценки заявки через `ExpertiseManager::evaluateApplication`.
2. Заявка имеет статус "На рассмотрении" (сохраняется в объекте `Application`).
3. Держатель фонда анализирует экспертные оценки через `ExpertiseManager::getEvaluation`.

---

## Результаты (Постусловия)
1. Заявка изменяет статус на "Отклонена" через `ApplicationManager::updateApplication`.
2. Причина отказа и комментарии сохраняются в объекте `Decision` через `DecisionManager::makeDecision`.
3. Заявитель получает уведомление об отказе через `NotificationManager::sendNotification`.
4. Решение фиксируется в системе для отчетности через `ReportManager::generateReport`.

---

## Основной успешный сценарий

### 1. Инициация отказа
- Держатель фонда выбирает заявку, используя метод `ApplicationManager::getApplicationByID(applicationID)`.
- Система отображает данные заявки из объекта `Application` и оценки из `Evaluation` через `ExpertiseManager::getEvaluation(applicationID)`.

### 2. Принятие решения
- Держатель фонда выбирает опцию "Отклонить заявку".
- Система запрашивает причину отказа и комментарии.
- Создается объект `Decision`:
  - `ID` — уникальный идентификатор решения.
  - `DecisionType` — тип решения ("Отклонено").
  - `Reason` — причина отказа.
  - `Application` — связанная заявка.
- Решение сохраняется через `DecisionManager::makeDecision(applicationID, decision)`.

### 3. Уведомление заявителя
- Система формирует уведомление (объект `Notification`) с причиной отказа:
  - `Message` — текст уведомления.
  - `Recipient` — заявитель.
  - `Date` — дата уведомления.
- Уведомление отправляется через `NotificationManager::sendNotification`.

### 4. Обновление статуса заявки
- Статус заявки обновляется на "Отклонена" через `ApplicationManager::updateApplication`.

---

## Варианты альтернативных решений

### 1. Ошибка при сохранении решения
- Если `DecisionManager::makeDecision` возвращает ошибку, система:
  - Логирует проблему через `ReportManager`.
  - Уведомляет администратора о необходимости повторного действия.

### 2. Отмена отказа
- Держатель фонда может пересмотреть решение через `DecisionManager::reviewDecision(applicationID)`:
  - Система изменяет статус заявки и обновляет объект `Decision`.

### 3. Ошибка при отправке уведомления
- Если `NotificationManager::sendNotification` не отправляет уведомление:
  - Система логирует ошибку.
  - Повторяет попытку отправки через `NotificationManager`.

---

## Расширения

### 1. История отказов
- Все решения сохраняются и доступны для анализа через `ReportManager::generateReport`.

### 2. Автоматическая аналитика
- Система генерирует отчет по причинам отказов для оптимизации грантовой программы.

### 3. Массовые отказы
- Возможность массового отклонения заявок с общей причиной через `DecisionManager`.

---

## Специальные требования
1. Решения фиксируются в системе с минимальной задержкой (до 5 секунд).
2. Уведомления отправляются немедленно после сохранения решения.
3. Данные заявителей и причины отказа защищены в соответствии с законодательством (например, GDPR).

---

## Связь с диаграммой
1. **ApplicationManager**: используется для управления данными заявок (`getApplicationByID`, `updateApplication`).
2. **ExpertiseManager**: предоставляет доступ к оценкам через `getEvaluation`.
3. **DecisionManager**: обрабатывает создание и хранение решений (`makeDecision`, `reviewDecision`).
4. **NotificationManager**: отправляет уведомления заявителям через `sendNotification`.
5. **ReportManager**: фиксирует и генерирует отчеты по всем принятым решениям (`generateReport`).

