# GrantIssuance.md

## Прецедент: "Выдача гранта"

Информационная система технической экспертизы.

---

## Уровень
Задача, определенная системой.

---

## Основной исполнитель
**Держатель фонда (FundHolder)**

---

## Заинтересованные лица и их требования

### 1. Держатель фонда (FundHolder)
- Возможность принимать решение о выдаче гранта.
- Уведомлять заявителя о принятом решении.
- Контролировать процесс обработки платежа.

### 2. Заявитель (Applicant)
- Получение уведомления о принятом решении и статусе заявки.
- Прозрачность и оперативность обработки заявки.

### 3. Финансовый менеджер (PaymentManager)
- Обеспечение обработки платежа.
- Логирование всех операций, связанных с платежами.

### 4. Администратор системы
- Контроль корректности всех операций.
- Логирование всех действий системы для аудита.

---

## Предусловия
1. Заявка подана и прошла этапы оценки.
2. Экспертные оценки сохранены в системе через `ExpertiseManager`.
3. Держатель фонда имеет доступ к заявке через `ApplicationManager`.

---

## Результаты (Постусловия)
1. Заявка обновлена со статусом "Одобрена".
2. Платеж обработан через `PaymentManager::processPayment`.
3. Заявитель уведомлен о решении через `NotificationManager::sendNotification`.
4. Решение зафиксировано в системе через `DecisionManager::makeDecision`.
5. Отчет о выданных грантах сформирован через `ReportManager::generateReport`.

---

## Основной успешный сценарий

### 1. Доступ к заявке
- Держатель фонда загружает данные заявки через `ApplicationManager::getApplicationByID(applicationID)`.
- Система возвращает объект заявки (`Application`), содержащий такие атрибуты, как:
  - `ID`: уникальный идентификатор заявки.
  - `Title`: название заявки.
  - `Description`: описание заявки.
  - `Status`: текущий статус заявки.

### 2. Получение оценки экспертов
- Держатель фонда запрашивает экспертные оценки заявки через `ExpertiseManager::getEvaluation(applicationID)`.
- Система возвращает объект `Evaluation`:
  - `Score`: оценка заявки.
  - `Comments`: комментарии экспертов.
  - `Expert`: ссылка на эксперта.

### 3. Принятие решения
- Держатель фонда принимает решение "Одобрено" через `DecisionManager::makeDecision(applicationID, decision)`.
- Система создает объект `Decision`, который включает:
  - `ID`: уникальный идентификатор решения.
  - `DecisionType`: тип решения ("Одобрено").
  - `Reason`: обоснование решения.
  - `Application`: ссылка на заявку.

### 4. Обновление статуса заявки
- Система обновляет статус заявки на "Одобрена" через `ApplicationManager::updateApplication(applicationID, updatedApplication)`.

### 5. Обработка платежа
- `PaymentManager::processPayment(applicationID, amount)` инициирует обработку платежа.
- Система создает объект `Payment`:
  - `ID`: уникальный идентификатор платежа.
  - `Amount`: сумма платежа.
  - `Status`: статус платежа ("Успешно").
  - `Date`: дата обработки платежа.

### 6. Уведомление заявителя
- Система отправляет уведомление заявителю через `NotificationManager::sendNotification(notification)`.
- Уведомление включает:
  - `Message`: сообщение о принятом решении ("Ваша заявка одобрена. Средства будут перечислены в ближайшее время.").
  - `Recipient`: заявитель.
  - `Date`: дата уведомления.

### 7. Генерация отчета
- `ReportManager::generateReport("Approved Grants", parameters)` формирует отчет о выданных грантах.
- Отчет включает данные о:
  - Всех одобренных заявках.
  - Решениях по ним.
  - Обработанных платежах.

---

## Варианты альтернативных решений

### 1. Ошибка обработки платежа
- Если `PaymentManager::processPayment` возвращает ошибку:
  - Система фиксирует ошибку через `ReportManager::logIssue`.
  - Заявитель уведомляется о задержке платежа через `NotificationManager::sendNotification`.
  - Администратор уведомляется о проблеме.

### 2. Отмена решения
- Если держатель фонда решает пересмотреть одобренное решение:
  - Используется метод `DecisionManager::reviewDecision`.
  - Заявитель уведомляется о пересмотре статуса заявки.

### 3. Ошибка отправки уведомления
- Если `NotificationManager::sendNotification` возвращает ошибку:
  - Система повторяет отправку уведомления.
  - Если уведомление не доставлено, фиксируется ошибка через `ReportManager`.

### 4. Ошибка обновления статуса заявки
- Если `ApplicationManager::updateApplication` возвращает ошибку:
  - Система уведомляет администратора.
  - Заявитель уведомляется о временных трудностях.

---

## Расширения

### 1. Массовая выдача грантов
- Держатель фонда может одобрить несколько заявок одновременно.
- Обработка каждого платежа выполняется через `PaymentManager`.

### 2. Интеграция с внешними системами
- Система может интегрироваться с банковскими платформами для автоматизации платежей.

---

## Специальные требования
1. Все действия системы должны быть зафиксированы через `ReportManager`.
2. Платежи должны быть обработаны не позднее 24 часов с момента принятия решения.
3. Уведомления заявителям должны быть доставлены в течение 1 часа после обновления статуса заявки.

---

## Связь с диаграммой классов

1. **ApplicationManager**
   - Управляет данными заявок (`getApplicationByID`, `updateApplication`).

2. **ExpertiseManager**
   - Обеспечивает доступ к экспертным оценкам через `getEvaluation`.

3. **DecisionManager**
   - Создает и сохраняет решения через `makeDecision`.

4. **PaymentManager**
   - Обрабатывает платежи через `processPayment`.

5. **NotificationManager**
   - Уведомляет заявителей через `sendNotification`.

6. **ReportManager**
   - Логирует действия системы и формирует отчеты через `generateReport`