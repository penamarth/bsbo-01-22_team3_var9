# GrantIssuance.md

## Прецедент: "Выдача гранта"

Информационная система технической экспертизы.

---

## Уровень
Задача, определенная системой.

---

## Основной исполнитель
**Держатель фонда (FundHolder)**

---

## Заинтересованные лица и их требования

### 1. Держатель фонда (FundHolder)
- Возможность быстро и корректно одобрить заявку.
- Инициировать процесс выдачи гранта.
- Уведомить заявителя о результатах.

### 2. Заявитель (Applicant)
- Получение уведомления о принятом решении и статусе заявки.
- Прозрачность и ясность процесса.

### 3. Финансовый менеджер (PaymentManager)
- Обработка платежа, связанного с выдачей гранта.
- Логирование всех операций.

### 4. Администратор системы
- Контроль корректности и безопасности выдачи грантов.
- Генерация отчетов о выданных грантах.

---

## Предусловия
1. Заявка прошла процесс оценки и имеет статус "На рассмотрении".
2. Эксперты завершили процесс оценки через `ExpertiseManager`.
3. Держатель фонда принял положительное решение о выдаче гранта.

---

## Результаты (Постусловия)
1. Заявка изменяет статус на "Одобрена".
2. Платеж обрабатывается через `PaymentManager::processPayment`.
3. Заявитель получает уведомление через `NotificationManager::sendNotification`.
4. Решение фиксируется в системе через `DecisionManager::makeDecision`.
5. Отчет о выданных грантах формируется через `ReportManager::generateReport`.

---

## Основной успешный сценарий

### 1. Принятие решения
- Держатель фонда выбирает заявку для выдачи гранта через `ApplicationManager::getApplicationByID(applicationID)`.
- Запрашивает экспертные оценки через `ExpertiseManager::getEvaluation(applicationID)`.
- Принимает решение "Одобрено" через `DecisionManager::makeDecision(applicationID, decision)`.
  - Решение включает:
    - `DecisionType`: "Одобрено".
    - `Reason`: Обоснование решения.
    - `Application`: ссылка на заявку.

### 2. Обработка платежа
- После сохранения решения, `PaymentManager::processPayment` инициирует обработку платежа:
  - `applicationID`: идентификатор заявки.
  - `amount`: сумма гранта.

### 3. Обновление статуса заявки
- Статус заявки обновляется на "Одобрена" через `ApplicationManager::updateApplication`.

### 4. Уведомление заявителя
- `NotificationManager::sendNotification` отправляет уведомление заявителю:
  - `Message`: "Ваша заявка одобрена, грант будет перечислен."
  - `Recipient`: пользователь, связанный с заявкой.

### 5. Генерация отчета
- `ReportManager::generateReport` формирует отчет о выданных грантах:
  - `reportType`: "Approved Grants".
  - `parameters`: данные о заявке и сумме гранта.

---

## Варианты альтернативных решений

### 1. Ошибка обработки платежа
- Если `PaymentManager::processPayment` возвращает ошибку:
  - Система фиксирует ошибку через `ReportManager::logIssue`.
  - Уведомляет администратора через `NotificationManager`.
  - Заявитель получает уведомление о задержке платежа.

### 2. Отмена решения
- Если держатель фонда решает пересмотреть одобренное решение:
  - Используется метод `DecisionManager::reviewDecision`.
  - Заявитель уведомляется о пересмотре статуса.

### 3. Ошибка отправки уведомления
- Если `NotificationManager::sendNotification` возвращает ошибку:
  - Система повторяет отправку уведомления несколько раз.
  - Если уведомление не доставлено, фиксируется лог ошибки через `ReportManager`.

### 4. Ошибка обновления статуса заявки
- Если `ApplicationManager::updateApplication` возвращает ошибку:
  - Система откатывает изменения, связанные с решением, и уведомляет администратора.
  - Заявитель уведомляется о временных трудностях.

---

## Расширения

### 1. Массовая выдача грантов
- Держатель фонда может одобрить несколько заявок одновременно.
- `PaymentManager` обрабатывает каждую заявку как отдельную транзакцию.
- `ReportManager` формирует единый отчет.

### 2. Интеграция с внешними системами
- Платежи могут интегрироваться с банковскими системами через API `PaymentManager`.

---

## Специальные требования
1. Обработка платежа и уведомление заявителя должны быть выполнены не позднее 24 часов после принятия решения.
2. Все действия логируются для аудита через `ReportManager`.

---

## Связь

1. **ApplicationManager**
   - Используется для управления заявками (`getApplicationByID`, `updateApplication`).

2. **ExpertiseManager**
   - Предоставляет доступ к оценкам заявки через метод `getEvaluation`.

3. **DecisionManager**
   - Фиксирует решения через метод `makeDecision`.

4. **PaymentManager**
   - Обрабатывает платежи через метод `processPayment`.

5. **NotificationManager**
   - Отправляет уведомления через метод `sendNotification`.

6. **ReportManager**
   - Формирует отчеты через метод `generateReport`.
   - Логирует ошибки через `logIssue`.
