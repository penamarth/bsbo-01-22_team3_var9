# DecisionMakingOperations.md

## Описание системных операций

Данный документ описывает системные операции, необходимые для реализации прецедента "Выдача гранта". Каждая операция связана с компонентами диаграммы классов и включает в себя подробные шаги выполнения, предусловия, действия и результаты.

---
### Операция: getApplicationByID(applicationID: UUID)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `ApplicationManager`.

#### Предусловия
1. Заявка с указанным идентификатором существует в системе.
2. Пользователь, запрашивающий информацию, аутентифицирован и имеет соответствующие права доступа к заявкам.

#### Действия
1. `ApplicationManager` принимает `applicationID` в качестве аргумента.
2. Метод `getApplicationByID` извлекает объект `Application` из хранилища данных на основе предоставленного идентификатора.
3. Система возвращает объект заявки с следующими атрибутами:
   - `ID`: Уникальный идентификатор заявки.
   - `Title`: Название заявки.
   - `Description`: Подробное описание заявки.
   - `Status`: Текущий статус заявки (например, "На рассмотрении", "Одобрена", "Отклонена").
   - `Applicant`: Ссылка на пользователя-заявителя, подавшего заявку.

#### Постусловия
- Объект заявки успешно извлечен из системы и доступен для последующей обработки или анализа.
- Держатель фонда может использовать информацию для принятия решения, пересмотра статуса или для последующих действий, таких как уведомление заявителя.

---

### **2. Операция: getEvaluation(applicationID: UUID)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `ExpertiseManager`.

#### Предусловия
1. Экспертная оценка заявки завершена.
2. Оценка успешно сохранена в системе.

#### Действия
1. `ExpertiseManager` принимает `applicationID` в качестве аргумента.
2. Метод `getEvaluation` извлекает объект `Evaluation`, связанный с указанной заявкой.
3. Система возвращает объект `Evaluation`, содержащий следующие атрибуты:
   - `Score`: Результаты оценки заявки.
   - `Comments`: Комментарии специалистов, которые проводили оценку заявки.
   - `Expert`: Информация об expert-е, проводившем оценку. 

#### Постусловия
- Объект оценки успешно извлечен и доступен для анализа держателем фонда или другими заинтересованными сторонами.
- Данные оценки могут быть использованы для обоснования принятия решения по заявке. 

---

### **3. Операция: makeDecision(applicationID: UUID, decision: Decision)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `DecisionManager`.

#### Предусловия
1. Держатель фонда завершил анализ заявки и все необходимые экспертные оценки.
2. Заявка имеет статус "На рассмотрении" или "Ожидает пересмотра".

#### Действия
1. Метод `makeDecision` принимает:
   - `applicationID`: Уникальный идентификатор заявки, по которой принимается решение.
   - `decision`: Объект решения, содержащий информацию о типе решения и обосновании.
2. Система создает объект `Decision` с атрибутами:
   - `ID`: Уникальный идентификатор решения.
   - `DecisionType`: Тип решения (например, "Одобрено", "Отклонено" или "Пересмотрено").
   - `Reason`: Обоснование принятого решения.
   - `Application`: Ссылка на заявку, к которой относится данное решение.
3. Решение сохраняется в системе. 
4. Система обновляет статус заявки, вызвав метод `updateApplication(applicationID, updatedApplication)`, чтобы отразить новое состояние (например, на "Одобрена" или "Отклонена").

#### Постусловия
- Решение успешно сохранено в системе.
- Заявка обновлена и готова для дальнейшей обработки, такой как выполнение платежа или уведомление заявителя о результате.

---

### **4. Операция: updateApplication(applicationID: UUID, updatedApplication: Application)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `ApplicationManager`.

#### Предусловия
1. Решение о заявке принято или пересмотрено.
2. Обновленный объект заявки доступен для обработки.

#### Действия
1. Метод `updateApplication` принимает:
   - `applicationID`: Уникальный идентификатор заявки, которая требует обновления.
   - `updatedApplication`: Обновленный объект заявки, содержащий новые данные .
2. `ApplicationManager` ищет в системе заявку с указанным `applicationID`.
3. Если заявка найдена:
   - Обновляются поля заявки.
4. В случае успешного обновления, система может вызвать дополнительный механизм для уведомления о изменении статуса.

#### Постусловия
- Заявка успешно обновлена с учетом новых данных.
- Лог изменений сохранен для аудита и последующего анализа.

---

### **5. Операция: sendNotification(notification: Notification)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `NotificationManager`.

#### Предусловия
1. Решение о заявке принято или пересмотрено.
2. Уведомление сформировано и готово к отправке.

#### Действия
1. Метод `sendNotification` принимает объект `Notification` с атрибутами:
   - `Message`: Текст уведомления, содержащий информацию о принятом или пересмотренном решении.
   - `Recipient`: Получатель уведомления.
   - `Date`: Дата отправки уведомления.
2. `NotificationManager` проверяет предпочтительный канал связи для получателя.
3. Уведомление отправляется пользователю через выбранный канал связи.
4. На случай ошибки отправки, система обрабатывает любые исключения и возвращает соответствующее сообщение о статусе отправки.

#### Постусловия
- Уведомление успешно доставлено получателю.
- Лог уведомления сохранен в системе.


---

### **6. Операция: generateReport(reportType: String, parameters: Map<String, Object>)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `ReportManager`.

#### Предусловия
1. Решения о заявках были приняты или пересмотрены.
2. Данные о заявках, решениях и их статусах доступны в системе.

#### Действия
1. Метод `generateReport` принимает:
   - `reportType`: Тип отчета.
   - `parameters`: Параметры фильтрации данных.
2. `ReportManager` собирает необходимые данные из:
   - `ApplicationManager` для получения информации о заявках.
   - `DecisionManager` для получения информации о принятых решениях и их результатах.
3. Система формирует объект `Report`:
   - `ID`: Уникальный идентификатор отчета.
   - `Title`: Название отчета, составленное на основе параметров.
   - `Content`: Данные о заявках, их статусах, принятых решениях и соответствующих объяснениях.
   - `GeneratedBy`: Пользователь, инициировавший генерацию отчета.
   - `Date`: Дата создания отчета.

#### Постусловия
- Отчет успешно сформирован, сохранен в системе и готов к анализу.
- Система предоставляет ссылку или идентификатор для доступа к вновь созданному отчету.

---

### **7. Операция: ExpertiseManager::requestAdditionalComments(applicationID: UUID)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `ExpertiseManager`.

#### Предусловия
1. Заявка с указанным идентификатором существует в системе.
2. Экспертная оценка завершена, но требуется дополнительная информация для окончательного решения.
3. Пользователь, инициирующий запрос, аутентифицирован и имеет соответствующие права доступа.

#### Действия
1. `ExpertiseManager` принимает `applicationID` в качестве аргумента.
2. Метод `requestAdditionalComments` извлекает объект `Application` из хранилища данных для анализа текущего состояния заявки и предыдущих комментариев, если они были.
3. Если требуется дополнительная информация, система:
   - Генерирует запрос на предоставление дополнительных комментариев к заявке, указывая, какие аспекты требуют уточнения.
   - Уведомляет соответствующих экспертов или членов комиссии, которые принимали участие в оценке, о необходимости предоставить дополнительные комментарии.
4. Система фиксирует время отправки запроса и сохраняет информацию о запросе в базе данных для последующего аудита.
5. Уведомления могут быть отправлены через электронную почту или внутреннюю систему сообщений для повышения информированности о запросе.

#### Постусловия
- Запрос на дополнительные комментарии успешно отправлен.
- История действий обновлена, что позволяет отслеживать процесс взаимодействия и возможные ответы на запрос.

---

### **8. Операция: NotificationManager::notifyFundHolder(request)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `NotificationManager`.

#### Предусловия
1. Система располагает контактной информацией для держателя фонда.
2. Запрос для уведомления (объект `request`) содержит всю необходимую информацию для извещения держателя фонда о событии или изменении статуса.

#### Действия
1. `NotificationManager` принимает объект `request` в качестве аргумента.
2. Метод `notifyFundHolder` извлекает из объекта `request` необходимые данные, такие как:
   - `FundHolderID`: Уникальный идентификатор держателя фонда, которому необходимо отправить уведомление.
   - `Message`: Сообщение, которое нужно отправить.
   - `NotificationType`: Тип уведомления.
3. Система проверяет, активен ли контактный метод, указанный для держателя фонда:
   - Если контактный метод активен, отправляется уведомление соответствующим образом (например, через службу отправки электронной почты).
   - Если активный метод отсутствует, система может генерировать альтернативное уведомление или записать ошибку.
4. Система фиксирует информацию о выполненном уведомлении в логах для последующего аудита и отслеживания.

#### Постусловия
- Уведомление о событии успешно отправлено держател. фонда.
- Запись о уведомлении добавлена в систему для последующего анализа и аудита.

---

### **9. Операция: DecisionManager::requestReview(applicationID)

#### Ссылка
- Прецедент: Принятие решения / Пересмотр решения.
- Компонент: `DecisionManager`.

#### Предусловия
1. Заявка с указанным идентификатором существует в системе.
2. Пользователь, инициирующий запрос, аутентифицирован и имеет соответствующие права доступа для запрашивания пересмотра.

#### Действия
1. `DecisionManager` принимает `applicationID` в качестве аргумента.
2. Метод `requestReview` извлекает объект `Application` из хранилища данных, чтобы проверить текущий статус заявки и историю принятых решений.
3. Если статус заявки позволяет запрашивать пересмотр:
   - Система создает запись о запросе на пересмотр в журнале действий.
   - Уведомления отправляются соответствующим членам комиссии или экспертам для информирования их о необходимости пересмотра заявки.
   - Опционально, может быть указана причина для запроса пересмотра, чтобы обеспечить более прозрачное обсуждение.
4. Система фиксирует время и данные запроса на пересмотр для последующего анализа и аудита.

#### Постусловия
- Запрос на пересмотр заявки успешно отправлен и зафиксирован.
- Уведомления о пересмотре готовы к отправке и находятся в очереди.