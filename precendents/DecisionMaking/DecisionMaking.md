# DecisionMaking.md

## Прецедент: "Принятие решения/пересмотр решения"

Информационная система технической экспертизы.

---

## Уровень
Задача, определенная системой.

---

## Основной исполнитель
**Держатель фонда (FundHolder)**

---

## Заинтересованные лица и их требования

### 1. Держатель фонда (FundHolder)
- Возможность принимать решения о выдаче грантов на основе оценок.
- Уведомлять заявителя о принятом решении или его пересмотре.
- Доступ к информации о ранее принятых решениях для оценки возможности пересмотра.
- Обеспечение обратной связи с экспертами по заявкам.

### 2. Заявитель (Applicant)
- Получение уведомления о принятом решении или пересмотре решения по заявке.
- Прозрачность и оперативность в информировании о статусе заявки и любых изменениях решения.
- Возможность запроса дополнительной информации о причинах пересмотра решения.

### 3. Эксперт (Expert)
- Возможность предоставления дополнительных комментариев или пояснений по заявкам в случае пересмотра.
- Уведомление о том, что их оценки используются для принятия или пересмотра решений.

### 4. Финансовый менеджер (PaymentManager)
- Обеспечение обработки платежа в случае одобрения, включая адаптацию процедуры при пересмотре решения.
- Логирование всех операций, связанных с платежами и изменениями статуса заявок.

### 5. Администратор системы
- Контроль корректности всех операций, связанных с принятием и пересмотром решений.
- Логирование всех действий системы для аудита, включая историю изменений решений.

---

## Предусловия
1. Заявка подана, прошла этапы оценки и находится на стадии принятия решения.
2. Экспертные оценки сохранены в системе через `ExpertiseManager`.
3. Держатель фонда имеет доступ к заявке и соответствующим экспертным оценкам через `ApplicationManager`.
4. Решение о выдаче гранта может быть пересмотрено в случае изменения обстоятельств (например, добавление новой информации или изменившиеся критерии).

---

## Результаты (Постусловия)
1. Решение о выдаче гранта обновлено или пересмотрено, при необходимости изменено на "Одобрено" или "Отклонено".
2. Если решение пересмотрено, процесс уведомления заявителя инициирован через `NotificationManager::sendNotification`.
3. История изменений решения зафиксирована в системе через `DecisionManager::makeDecision`, включая информацию о причинах пересмотра.
4. При необходимости, отчет о пересмотренных заявках сформирован через `ReportManager::generateReport`.


---

## Основной успешный сценарий

### 1. Доступ к заявке
- Держатель фонда загружает данные заявки через `ApplicationManager::getApplicationByID(applicationID)`.
- Система возвращает объект заявки (`Application`), содержащий такие атрибуты, как:
  - `ID`: уникальный идентификатор заявки.
  - `Title`: название заявки.
  - `Description`: описание заявки.
  - `Status`: текущий статус заявки.

### 2. Получение оценки экспертов
- Держатель фонда запрашивает экспертные оценки для заявки через `ExpertiseManager::getEvaluation(applicationID)`.
- Система возвращает объект `Evaluation`:
  - `Score`: оценка заявки.
  - `Comments`: комментарии экспертов.
  - `Expert`: ссылка на эксперта.

### 3. Принятие или пересмотр решения
- Держатель фонда принимает или пересматривает решение через `DecisionManager::makeDecision(applicationID, decision)`. В зависимости от оценки и других факторов решение может быть изменено.
- Система создает или обновляет объект `Decision`, который включает:
  - `ID`: уникальный идентификатор решения.
  - `DecisionType`: тип решения ("Одобрено" или "Отклонено").
  - `Reason`: обоснование решения (например, причины отклонения или дополнительные условия для одобрения).
  - `Application`: ссылка на заявку.

### 4. Обновление статуса заявки
- Система обновляет статус заявки в зависимости от принятого решения через `ApplicationManager::updateApplication(applicationID, updatedApplication)`.

### 5. Уведомление заявителя
- Система отправляет уведомление заявителю через `NotificationManager::sendNotification(notification)`.
- Уведомление включает:
  - `Message`: сообщение о принятом решении ("Ваша заявка одобрена" или "Ваша заявка отклонена, причины: [указать причины]").
  - `Recipient`: заявитель.
  - `Date`: дата уведомления.

### 6. Генерация отчета
- При необходимости система формирует отчет о результатах принятых решений через `ReportManager::generateReport("Decision Outcomes", parameters)`.
- Отчет включает данные о:
  - Всех принятых решениях.
  - Обоснованиях к ним.
  - Статусах заявок после пересмотра.
  
---

## Варианты альтернативных решений

### 1. Ошибка обработки решения
- Если `DecisionManager::makeDecision` возвращает ошибку:
  - Система фиксирует ошибку через `ReportManager::logIssue`.
  - Держатель фонда уведомляется о проблеме.
  - Возможны дополнительные попытки повторить операцию по принятию или пересмотру решения.

### 2. Необходимость проверки экспертной оценки
- Если Держатель фонда считает, что экспертные оценки не полные или требуются дополнительные комментарии:
  - Используется метод `ExpertiseManager::requestAdditionalComments(applicationID)`.
  - Заявитель и эксперты уведомляются о необходимости дополнительной информации.

### 3. Ошибка отправки уведомления о решении
- Если `NotificationManager::sendNotification` возвращает ошибку при отправке уведомления о решении:
  - Система повторяет отправку уведомления.
  - Если уведомление не доставлено, фиксируется ошибка через `ReportManager::logIssue`.

### 4. Ошибка обновления статуса заявки
- Если `ApplicationManager::updateApplication` возвращает ошибку:
  - Система уведомляет администратора о проблеме.
  - Заявитель уведомляется о временных трудностях с обновлением статуса заявки.

### 5. Запрос на пересмотр решения от заявителя
- Если заявитель подает запрос на пересмотр ранее принятого решения:
  - Держатель фонда получает уведомление о запросе через `NotificationManager::notifyFundHolder(request)`.
  - Держатель фонда инициирует процесс пересмотра через `DecisionManager::requestReview(applicationID)`.

### 6. Критерии для пересмотра решений
- Если инициализирован процесс пересмотра решения, но отсутствуют достаточные основания для этого:
  - Система фиксирует отсутствие оснований через `ReportManager::logIssue`.
  - Заявитель уведомляется о причинах, по которым пересмотр не может быть осуществлён.

---

## Расширения

### 1. Массовая обработка решений
- Держатель фонда может одновременно просматривать и принимать решения по нескольким заявкам.
- Заявители получают уведомления о решениях сразу после массовой обработки.

### 2. Интеграция с внешними аналитическими инструментами
- Система может интегрироваться с внешними аналитическими платформами для улучшения оценки заявок и принятия решений.
- Держатель фонда получает доступ к дополнительным данным, аналитическим отчетам и рекомендациям при принятии решений.

### 3. Поддержка комментариев и обратной связи
- Эксперты и заявители могут оставлять комментарии о процессе принятия решений, которые будут доступны для анализа и улучшения.
- Держатель фонда получает возможность учитывать этот фидбек в качестве дополнительного ресурса для улучшения критериев и процесса.

---

## Специальные требования
1. Все действия системы должны быть зафиксированы через `ReportManager`.
2. Оповещение о пересмотре: Уведомление заявителю о пересмотре решения должно быть доставлено в течение 1 часа после его инициации.
3. Обоснование решений: Все принятые решения должны включать обоснования, которые будут храниться в системе и доступны для просмотра заявителю и администраторам по запросу.

---

## Связь с диаграммой классов

1. **ApplicationManager**
   - Управляет данными заявок (`getApplicationByID`, `updateApplication`).

2. **ExpertiseManager**
   - Обеспечивает доступ к экспертным оценкам через `getEvaluation`.

3. **DecisionManager**
   - Создает и сохраняет решения через `makeDecision`.

4. **NotificationManager**
   - Уведомляет заявителей через `sendNotification`.

5. **ReportManager**
   - Логирует действия системы и формирует отчеты через `generateReport`




